{"paragraphs":[{"text":"%md\n## GDELT Data Preprocessing and Analytics with MongoDB and AWS\n\n### Step 3: MongoDB GDELT Queries\n\n**Packages**","user":"anonymous","dateUpdated":"2020-01-26T14:08:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>GDELT Data Preprocessing and Analytics with MongoDB and AWS</h2>\n<h3>Step 3: MongoDB GDELT Queries</h3>\n<p><strong>Packages</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046211291_1740384153","id":"20200123-184338_961092340","dateCreated":"2020-01-26T13:43:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2098","dateFinished":"2020-01-26T14:08:31+0000","dateStarted":"2020-01-26T14:08:31+0000"},{"text":"%python\nimport numpy as np\nimport time\nimport timeit\nimport pandas as pd\nimport pymongo as mb\n\nfrom pprint import pprint\n#from tqdm import tqdm\n\nimport io\nimport boto3\n","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046211296_-780199768","id":"20200123-184351_2072761442","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2099"},{"text":"%python\nHOST_SERVER = \"****************\"\nmongo_client = mb.MongoClient(HOST_SERVER)","user":"anonymous","dateUpdated":"2020-01-26T14:09:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046211296_1601156644","id":"20200123-184422_756620467","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2100"},{"text":"%python\nprint(mongo_client.list_database_names())","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[u'MSBD_2019_2020', u'admin', u'config', u'local']\n"}]},"apps":[],"jobName":"paragraph_1580046211297_-1691080065","id":"20200123-184533_1739568427","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2101"},{"text":"%python\n# Create MongoDB Database\nmsbd_database = mongo_client['MSBD_2019_2020']","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046211297_311674743","id":"20200123-184743_1687670990","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2102"},{"text":"%python\ngdelt_main_collection = msbd_database['gdelt_main']\ngdelt_gkg_collection = msbd_database['gdelt_gkg']","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046211297_2056624947","id":"20200123-184726_115496704","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2103"},{"text":"%python\npprint(gdelt_main_collection.count_documents(filter={}))\npprint(gdelt_gkg_collection.count_documents(filter={}))","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2236189\n2670618\n"}]},"apps":[],"jobName":"paragraph_1580046211297_-1496181406","id":"20200123-184815_820415109","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2104"},{"text":"%md\n**1. Afficher le nombre d’articles/évènements qu’il y a eu pour chaque triplet (jour, pays de l’évènement, langue de l’article)**","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p><strong>1. Afficher le nombre d’articles/évènements qu’il y a eu pour chaque triplet (jour, pays de l’évènement, langue de l’article)</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046211297_1380227761","id":"20200123-184457_2092186777","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2105"},{"text":"%python\nquery_mb_events_triplet = [\n    {'$group': {'_id': {'date':'$SQLDATE',\n                        'event_country': '$ActionGeo_CountryCode'},\n                'NbEvents': {'$sum': 1}}\n    }\n]\n\nresult_events_triplet = list(gdelt_main_collection.aggregate(query_mb_events_triplet))\nprint(len(result_events_triplet))","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10980\n"}]},"apps":[],"jobName":"paragraph_1580046211297_333247338","id":"20200123-184502_1082165485","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2106"},{"text":"%python\npprint(sorted(result_events_triplet, key=lambda x: x['NbEvents'], reverse=True)[:20])","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[{u'NbEvents': 35779, u'_id': {u'date': 20190131, u'event_country': u'US'}},\n {u'NbEvents': 33897, u'_id': {u'date': 20190115, u'event_country': u'US'}},\n {u'NbEvents': 33856, u'_id': {u'date': 20190118, u'event_country': u'US'}},\n {u'NbEvents': 33126, u'_id': {u'date': 20190108, u'event_country': u'US'}},\n {u'NbEvents': 31423, u'_id': {u'date': 20190117, u'event_country': u'US'}},\n {u'NbEvents': 30671, u'_id': {u'date': 20190116, u'event_country': u'US'}},\n {u'NbEvents': 29868, u'_id': {u'date': 20190125, u'event_country': u'US'}},\n {u'NbEvents': 29773, u'_id': {u'date': 20190123, u'event_country': u'US'}},\n {u'NbEvents': 28738, u'_id': {u'date': 20190103, u'event_country': u'US'}},\n {u'NbEvents': 28696, u'_id': {u'date': 20190130, u'event_country': u'US'}},\n {u'NbEvents': 28568, u'_id': {u'date': 20190128, u'event_country': u'US'}},\n {u'NbEvents': 26485, u'_id': {u'date': 20190124, u'event_country': u'US'}},\n {u'NbEvents': 26466, u'_id': {u'date': 20190129, u'event_country': u'US'}},\n {u'NbEvents': 26130, u'_id': {u'date': 20190110, u'event_country': u'US'}},\n {u'NbEvents': 25465, u'_id': {u'date': 20190111, u'event_country': u'US'}},\n {u'NbEvents': 25403, u'_id': {u'date': 20190109, u'event_country': u'US'}},\n {u'NbEvents': 24447, u'_id': {u'date': 20190102, u'event_country': u'US'}},\n {u'NbEvents': 22841, u'_id': {u'date': 20190122, u'event_country': u'US'}},\n {u'NbEvents': 22745, u'_id': {u'date': 20190104, u'event_country': u'US'}},\n {u'NbEvents': 22079, u'_id': {u'date': 20190114, u'event_country': u'US'}}]\n"}]},"apps":[],"jobName":"paragraph_1580046211297_726326918","id":"20200123-184937_53273402","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2107"},{"text":"%python\nquery_mb_events_triplet = [\n    {'$group': {'_id': {'date':'$SQLDATE',\n                        'event_country': '$ActionGeo_CountryCode'},\n                'NbArticles': {'$sum': '$NumMentions'}}\n    }\n]\n\nresult_events_triplet = list(gdelt_main_collection.aggregate(query_mb_events_triplet))\nprint(len(result_events_triplet))\npprint(sorted(result_events_triplet, key=lambda x: x['NbArticles'], reverse=True)[:20])","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10980\n[{u'NbArticles': 160296, u'_id': {u'date': 20190131, u'event_country': u'US'}},\n {u'NbArticles': 156947, u'_id': {u'date': 20190118, u'event_country': u'US'}},\n {u'NbArticles': 156099, u'_id': {u'date': 20190108, u'event_country': u'US'}},\n {u'NbArticles': 148415, u'_id': {u'date': 20190115, u'event_country': u'US'}},\n {u'NbArticles': 142471, u'_id': {u'date': 20190125, u'event_country': u'US'}},\n {u'NbArticles': 142023, u'_id': {u'date': 20190116, u'event_country': u'US'}},\n {u'NbArticles': 138970, u'_id': {u'date': 20190117, u'event_country': u'US'}},\n {u'NbArticles': 138160, u'_id': {u'date': 20190123, u'event_country': u'US'}},\n {u'NbArticles': 132632, u'_id': {u'date': 20190103, u'event_country': u'US'}},\n {u'NbArticles': 130962, u'_id': {u'date': 20190130, u'event_country': u'US'}},\n {u'NbArticles': 129564, u'_id': {u'date': 20190128, u'event_country': u'US'}},\n {u'NbArticles': 121087, u'_id': {u'date': 20190129, u'event_country': u'US'}},\n {u'NbArticles': 119692, u'_id': {u'date': 20190124, u'event_country': u'US'}},\n {u'NbArticles': 118337, u'_id': {u'date': 20190110, u'event_country': u'US'}},\n {u'NbArticles': 114455, u'_id': {u'date': 20190109, u'event_country': u'US'}},\n {u'NbArticles': 114437, u'_id': {u'date': 20190102, u'event_country': u'US'}},\n {u'NbArticles': 112977, u'_id': {u'date': 20190111, u'event_country': u'US'}},\n {u'NbArticles': 105067, u'_id': {u'date': 20190104, u'event_country': u'US'}},\n {u'NbArticles': 104788, u'_id': {u'date': 20190114, u'event_country': u'US'}},\n {u'NbArticles': 104324, u'_id': {u'date': 20190122, u'event_country': u'US'}}]\n"}]},"apps":[],"jobName":"paragraph_1580046211298_889830403","id":"20200123-184504_654635499","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2108"},{"text":"%md\n**2. Pour un pays donné en paramètre, affichez les évènements qui y ont eu place triées par le nombre de mentions (tri décroissant); permettez une agrégation par jour/mois/année.**","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p><strong>2. Pour un pays donné en paramètre, affichez les évènements qui y ont eu place triées par le nombre de mentions (tri décroissant); permettez une agrégation par jour/mois/année.</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046211298_1907310353","id":"20200123-185119_1527368471","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2109"},{"text":"%python\r\nquery_mb_events_triplet = [\r\n    {'$match': {'ActionGeo_CountryCode' : 'US'}},\r\n    {'$group': {'_id': {'EVENT':'$GLOBALEVENTID', 'DATE': '$SQLDATE'},\r\n                'NbMentions': {'$sum': '$NumMentions'}}}\r\n]\r\n\r\nresult_events_triplet = list(gdelt_main_collection.aggregate(query_mb_events_triplet, allowDiskUse=True))\r\nprint(len(result_events_triplet))\r\npprint(sorted(result_events_triplet, key=lambda x: x['NbMentions'], reverse=True)[:20])","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"753457\n[{u'NbMentions': 300, u'_id': {u'DATE': 20190105, u'EVENT': 814160643}},\n {u'NbMentions': 256, u'_id': {u'DATE': 20190114, u'EVENT': 816021194}},\n {u'NbMentions': 246, u'_id': {u'DATE': 20190110, u'EVENT': 815392568}},\n {u'NbMentions': 223, u'_id': {u'DATE': 20190129, u'EVENT': 819844761}},\n {u'NbMentions': 223, u'_id': {u'DATE': 20190129, u'EVENT': 819846222}},\n {u'NbMentions': 220, u'_id': {u'DATE': 20190102, u'EVENT': 813682832}},\n {u'NbMentions': 216, u'_id': {u'DATE': 20190123, u'EVENT': 818480335}},\n {u'NbMentions': 200, u'_id': {u'DATE': 20190130, u'EVENT': 820198384}},\n {u'NbMentions': 192, u'_id': {u'DATE': 20190108, u'EVENT': 814676520}},\n {u'NbMentions': 192, u'_id': {u'DATE': 20190108, u'EVENT': 814721631}},\n {u'NbMentions': 190, u'_id': {u'DATE': 20190116, u'EVENT': 816546245}},\n {u'NbMentions': 180, u'_id': {u'DATE': 20190108, u'EVENT': 814834602}},\n {u'NbMentions': 180, u'_id': {u'DATE': 20190131, u'EVENT': 820397167}},\n {u'NbMentions': 171, u'_id': {u'DATE': 20190116, u'EVENT': 816548881}},\n {u'NbMentions': 170, u'_id': {u'DATE': 20190129, u'EVENT': 819667763}},\n {u'NbMentions': 168, u'_id': {u'DATE': 20190125, u'EVENT': 819037403}},\n {u'NbMentions': 161, u'_id': {u'DATE': 20190120, u'EVENT': 817555064}},\n {u'NbMentions': 160, u'_id': {u'DATE': 20190122, u'EVENT': 818113812}},\n {u'NbMentions': 160, u'_id': {u'DATE': 20190122, u'EVENT': 818114177}},\n {u'NbMentions': 160, u'_id': {u'DATE': 20190125, u'EVENT': 818788653}}]\n"}]},"apps":[],"jobName":"paragraph_1580046211298_-1586624408","id":"20200123-184505_873788512","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2110"},{"text":"%python\n","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580046211298_2045808270","id":"20200123-185346_403292059","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2111"},{"text":"%md\n**3. Pour une source de données passée en paramètre (gkg.SourceCommonName) affichez les thèmes, personnes, lieux dont les articles de cette sources parlent ainsi que le le nombre d’articles et le ton moyen des articles (pour chaque thème/personne/lieu); permettez une agrégation par jour/mois/année**","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p><strong>3. Pour une source de données passée en paramètre (gkg.SourceCommonName) affichez les thèmes, personnes, lieux dont les articles de cette sources parlent ainsi que le le nombre d’articles et le ton moyen des articles (pour chaque thème/personne/lieu); permettez une agrégation par jour/mois/année</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046211298_871973181","id":"20200123-190509_1551619867","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2112"},{"text":"%python\nquery_mb_events_triplet = [\n    {'$match': {'SourceCommonName': 'eveningexpress.co.uk'}},\n    {'$unwind': '$Themes'},\n    {'$project' : { 'Themes' : 1, 'GKGRECORDID' : 1, 'V2Tone.tone': 1}},\n    {'$group': {'_id': {'EVENT':'$Themes'},\n                'AvgTone': {'$avg': '$V2Tone.tone'},\n                'NbArticles': {'$sum': 1}\n                }}\n]\n\nresult_events_triplet = list(gdelt_gkg_collection.aggregate(query_mb_events_triplet, allowDiskUse=True))\nprint(len(result_events_triplet))\npd.DataFrame(result_events_triplet).sort_values('AvgTone').head(15)","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2309\n        AvgTone  NbArticles                                                _id\n1869 -14.024390           1            {u'EVENT': u'TAX_ETHNICITY_ZIMBABWEAN'}\n123  -11.616162           1   {u'EVENT': u'TAX_WORLDMAMMALS_TASMANIAN_DEVILS'}\n29   -11.616162           1    {u'EVENT': u'TAX_WORLDMAMMALS_TASMANIAN_DEVIL'}\n331  -11.197384           2          {u'EVENT': u'TAX_DISEASE_BRAIN_INJURIES'}\n1159 -10.882353           1  {u'EVENT': u'TAX_DISEASE_TRAUMATIC_BRAIN_INJURY'}\n671  -10.596026           1           {u'EVENT': u'WB_2668_INCOME_INEQUALITY'}\n277  -10.291898           2            {u'EVENT': u'TAX_FNCACT_CHIEF_JUSTICE'}\n1687  -9.596929           1                {u'EVENT': u'TAX_DISEASE_ASPHYXIA'}\n399   -9.514181           2         {u'EVENT': u'TAX_WORLDLANGUAGES_ROMANIAN'}\n871   -9.514181           2              {u'EVENT': u'TAX_ETHNICITY_ROMANIAN'}\n956   -9.306661           2              {u'EVENT': u'TAX_FNCACT_PATHOLOGIST'}\n1480  -9.137931           1          {u'EVENT': u'WB_549_OIL_AND_GAS_SYSTEMS'}\n1788  -9.137931           1        {u'EVENT': u'WB_1768_OIL_AND_GAS_PIPELINE'}\n672   -9.137931           1                        {u'EVENT': u'BLACK_MARKET'}\n362   -9.099443           2  {u'EVENT': u'MANMADE_DISASTER_PIPELINE_EXPLOSI...\n"}]},"apps":[],"jobName":"paragraph_1580046211299_-1297886319","id":"20200123-185342_29527390","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2113"},{"text":"%python\npd.DataFrame(result_events_triplet).sort_values('NbArticles', ascending=False).head(15)","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"       AvgTone  NbArticles                                             _id\n333  -1.360594        1900                       {u'EVENT': u'TAX_FNCACT'}\n492  -1.088625         818                    {u'EVENT': u'TAX_ETHNICITY'}\n306  -3.301530         766           {u'EVENT': u'CRISISLEX_CRISISLEXREC'}\n457  -1.769826         693                       {u'EVENT': u'EPU_POLICY'}\n2029 -3.584273         656             {u'EVENT': u'CRISISLEX_C07_SAFETY'}\n1293 -1.056801         540       {u'EVENT': u'UNGP_FORESTS_RIVERS_OCEANS'}\n2221 -1.658126         521               {u'EVENT': u'GENERAL_GOVERNMENT'}\n147  -2.116124         516             {u'EVENT': u'SOC_POINTSOFINTEREST'}\n2043 -2.736239         500         {u'EVENT': u'MANMADE_DISASTER_IMPLIED'}\n1437 -3.868638         499                {u'EVENT': u'SECURITY_SERVICES'}\n1245 -3.895396         489                {u'EVENT': u'TAX_FNCACT_POLICE'}\n448  -2.498162         457  {u'EVENT': u'WB_696_PUBLIC_SECTOR_MANAGEMENT'}\n533  -0.862708         449               {u'EVENT': u'TAX_WORLDLANGUAGES'}\n1622 -1.661542         446          {u'EVENT': u'USPEC_POLITICS_GENERAL1'}\n432  -1.460458         440            {u'EVENT': u'EPU_POLICY_GOVERNMENT'}\n"}]},"apps":[],"jobName":"paragraph_1580046211299_518099851","id":"20200123-185344_229596173","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2114"},{"text":"%python\nquery_mb_events_triplet = [\n    {'$match': {'SourceCommonName' : 'eveningexpress.co.uk'}},\n    {'$unwind': '$Locations'},\n    {'$project' : { 'Locations' : 1, 'GKGRECORDID' : 1, 'V2Tone.tone': 1}},\n    {'$group': {'_id': {'EVENT':'$Locations.full_name'},\n                'AvgTone': {'$avg': '$V2Tone.tone'},\n                'NbArticles': {'$sum': 1}\n                }}\n]\n\nresult_events_triplet = list(gdelt_gkg_collection.aggregate(query_mb_events_triplet))\nprint(len(result_events_triplet))\npd.DataFrame(result_events_triplet).sort_values('AvgTone').head(15)","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"962\n       AvgTone  NbArticles                                                _id\n774 -14.024390           1  {u'EVENT': u'Malaba, Provincia De Bioko Norte,...\n793 -14.024390           1        {u'EVENT': u'Charamba, Masvingo, Zimbabwe'}\n470 -14.024390           1  {u'EVENT': u'Harare, Mashonaland East, Zimbabwe'}\n502 -12.500000           1        {u'EVENT': u'Methil, Fife, United Kingdom'}\n119 -11.512415           1  {u'EVENT': u'West Brompton, Kensington And Che...\n494 -11.512415           1  {u'EVENT': u'Blackfriars, London, City Of, Uni...\n673 -11.261261           1  {u'EVENT': u'Draycott, Derbyshire, United King...\n824 -11.091854           1      {u'EVENT': u'Neasden, Brent, United Kingdom'}\n225  -9.906220           2             {u'EVENT': u'Baracoa, GuantáMo, Cuba'}\n664  -9.137976           3                            {u'EVENT': u'Zimbabwe'}\n893  -9.099443           2  {u'EVENT': u'San Juan Del Rio, QueréRo De Arte...\n560  -9.099443           2       {u'EVENT': u'Tlahuelilpan, Hidalgo, Mexico'}\n431  -9.099443           2  {u'EVENT': u'Queretaro, QueréRo De Arteaga, Me...\n639  -8.994709           1  {u'EVENT': u'Adelaide, South Australia, Austra...\n474  -8.730159           1   {u'EVENT': u'Dunmurry, Lisburn, United Kingdom'}\n"}]},"apps":[],"jobName":"paragraph_1580046211299_-247020062","id":"20200123-190903_599133419","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2115"},{"text":"%python\nquery_mb_events_triplet = [\n    {'$match': {'SourceCommonName' : 'eveningexpress.co.uk'}},\n    {'$unwind': '$Persons'},\n    {'$project' : { 'Persons' : 1, 'GKGRECORDID' : 1, 'V2Tone.tone': 1}},\n    {'$group': {'_id': {'EVENT':'$Persons'},\n                'AvgTone': {'$avg': '$V2Tone.tone'},\n                'NbArticles': {'$sum': 1}\n                }}\n]\n\nresult_events_triplet = list(gdelt_gkg_collection.aggregate(query_mb_events_triplet))\nprint(len(result_events_triplet))\npd.DataFrame(result_events_triplet).sort_values('NbArticles', ascending=False).head(15)","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"4316\n       AvgTone  NbArticles                             _id\n3442 -1.677960         285                 {u'EVENT': u''}\n4097 -1.653265         132      {u'EVENT': u'theresa may'}\n2991 -1.403890          61    {u'EVENT': u'jeremy corbyn'}\n2950 -1.769563          53     {u'EVENT': u'donald trump'}\n3315 -1.633897          39  {u'EVENT': u'nicola sturgeon'}\n229   0.194051          33    {u'EVENT': u'derek mcinnes'}\n3438 -2.291448          29      {u'EVENT': u'john bercow'}\n2183  1.591041          24      {u'EVENT': u'los angeles'}\n197  -1.035884          23          {u'EVENT': u'yui mok'}\n3058 -2.561332          21        {u'EVENT': u'sinn fein'}\n2601 -1.414346          20     {u'EVENT': u'leo varadkar'}\n4109 -1.350181          20    {u'EVENT': u'yvette cooper'}\n1565 -0.432523          20  {u'EVENT': u'andrew milligan'}\n2750 -3.973735          19      {u'EVENT': u'anna soubry'}\n1704 -0.956257          19    {u'EVENT': u'simon coveney'}\n"}]},"apps":[],"jobName":"paragraph_1580046211300_-1981701335","id":"20200123-191223_692123269","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2116"},{"text":"%md\n**4. Dresser la cartographie des relations entre les pays d’après le ton des articles : pour chaque paire (pays1, pays2), calculer le nombre d’article, le ton moyen (aggrégations sur Année/Mois/Jour, filtrage par pays ou carré de coordonnées).**","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p><strong>4. Dresser la cartographie des relations entre les pays d’après le ton des articles : pour chaque paire (pays1, pays2), calculer le nombre d’article, le ton moyen (aggrégations sur Année/Mois/Jour, filtrage par pays ou carré de coordonnées).</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046211300_-892053797","id":"20200123-191753_256823581","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2117"},{"text":"%python\nquery_mb_events_triplet = [\n        {'$match': {\"$or\": [{\"Actor1Geo_CountryCode\": 'US'}, {\"Actor2Geo_CountryCode\": 'US'}]}},\n        {'$group': {'_id': {'pays1': '$Actor1Geo_CountryCode', 'pays2': '$Actor2Geo_CountryCode', 'DATE': '$SQLDATE'},\n                    'NbArticles': {'$sum': '$NumArticles'},\n                    'AvgPaysTone': {'$avg': '$AvgTone'}\n                   }}\n]\n\nresult_events_triplet = list(gdelt_main_collection.aggregate(query_mb_events_triplet, allowDiskUse=True))\nprint(len(result_events_triplet))\npprint(sorted(result_events_triplet, key=lambda x: x['NbArticles'], reverse=True)[:20])","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"7810\n[{u'AvgPaysTone': -2.2336415985477673,\n  u'NbArticles': 74177,\n  u'_id': {u'DATE': 20190131, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.030528711351165,\n  u'NbArticles': 72689,\n  u'_id': {u'DATE': 20190118, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -1.982738866175945,\n  u'NbArticles': 70582,\n  u'_id': {u'DATE': 20190115, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.373473365108511,\n  u'NbArticles': 70045,\n  u'_id': {u'DATE': 20190108, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -1.871392218666539,\n  u'NbArticles': 66414,\n  u'_id': {u'DATE': 20190116, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.0881193040315726,\n  u'NbArticles': 66077,\n  u'_id': {u'DATE': 20190123, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.4724379871389006,\n  u'NbArticles': 65529,\n  u'_id': {u'DATE': 20190125, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.0302119414385573,\n  u'NbArticles': 65086,\n  u'_id': {u'DATE': 20190117, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.2095967256947997,\n  u'NbArticles': 60294,\n  u'_id': {u'DATE': 20190103, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.316253810543731,\n  u'NbArticles': 59250,\n  u'_id': {u'DATE': 20190130, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -1.8393818279749612,\n  u'NbArticles': 59126,\n  u'_id': {u'DATE': 20190128, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -1.9152049396496402,\n  u'NbArticles': 57130,\n  u'_id': {u'DATE': 20190131, u'pays1': u'US', u'pays2': u''}},\n {u'AvgPaysTone': -2.2546958550130687,\n  u'NbArticles': 56903,\n  u'_id': {u'DATE': 20190124, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.1443381733391917,\n  u'NbArticles': 56253,\n  u'_id': {u'DATE': 20190108, u'pays1': u'US', u'pays2': u''}},\n {u'AvgPaysTone': -1.8277988124132523,\n  u'NbArticles': 55320,\n  u'_id': {u'DATE': 20190118, u'pays1': u'US', u'pays2': u''}},\n {u'AvgPaysTone': -1.9827303004131183,\n  u'NbArticles': 55269,\n  u'_id': {u'DATE': 20190110, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.3143526476795926,\n  u'NbArticles': 54536,\n  u'_id': {u'DATE': 20190129, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.4130783730596574,\n  u'NbArticles': 52944,\n  u'_id': {u'DATE': 20190109, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -2.178971851903695,\n  u'NbArticles': 51811,\n  u'_id': {u'DATE': 20190111, u'pays1': u'US', u'pays2': u'US'}},\n {u'AvgPaysTone': -1.9518090664823533,\n  u'NbArticles': 51654,\n  u'_id': {u'DATE': 20190115, u'pays1': u'US', u'pays2': u''}}]\n"}]},"apps":[],"jobName":"paragraph_1580046211300_-176483754","id":"20200123-191225_606799541","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2118"},{"text":"%python\nquery_mb_events_triplet = [\n        {'$match': {\"$or\": [{\"Actor1Geo_CountryCode\": 'US'}, {\"Actor2Geo_CountryCode\": 'US'}]}},\n        {'$group': {'_id': {'pays1': '$Actor1Geo_CountryCode', 'pays2': '$Actor2Geo_CountryCode'},\n                    'NbArticles': {'$sum': '$NumArticles'},\n                    'AvgPaysTone': {'$avg': '$AvgTone'}\n                   }}\n]\n\nresult_events_triplet = list(gdelt_main_collection.aggregate(query_mb_events_triplet, allowDiskUse=True))\nprint(len(result_events_triplet))\npprint(sorted(result_events_triplet, key=lambda x: x['AvgPaysTone'], reverse=False)[:20])","user":"anonymous","dateUpdated":"2020-01-26T13:43:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"424\n[{u'AvgPaysTone': -8.33333333333329,\n  u'NbArticles': 8,\n  u'_id': {u'pays1': u'BY', u'pays2': u'US'}},\n {u'AvgPaysTone': -8.0,\n  u'NbArticles': 1,\n  u'_id': {u'pays1': u'US', u'pays2': u'YI'}},\n {u'AvgPaysTone': -7.770582793709531,\n  u'NbArticles': 3,\n  u'_id': {u'pays1': u'US', u'pays2': u'FM'}},\n {u'AvgPaysTone': -7.458756146718731,\n  u'NbArticles': 11,\n  u'_id': {u'pays1': u'GK', u'pays2': u'US'}},\n {u'AvgPaysTone': -7.26114649681529,\n  u'NbArticles': 4,\n  u'_id': {u'pays1': u'OC', u'pays2': u'US'}},\n {u'AvgPaysTone': -7.055929014482666,\n  u'NbArticles': 53,\n  u'_id': {u'pays1': u'US', u'pays2': u'MZ'}},\n {u'AvgPaysTone': -6.902623002413661,\n  u'NbArticles': 37,\n  u'_id': {u'pays1': u'US', u'pays2': u'GV'}},\n {u'AvgPaysTone': -6.56775753171861,\n  u'NbArticles': 36,\n  u'_id': {u'pays1': u'US', u'pays2': u'VC'}},\n {u'AvgPaysTone': -6.512422773776172,\n  u'NbArticles': 413,\n  u'_id': {u'pays1': u'US', u'pays2': u'SU'}},\n {u'AvgPaysTone': -6.499974321756515,\n  u'NbArticles': 3,\n  u'_id': {u'pays1': u'AC', u'pays2': u'US'}},\n {u'AvgPaysTone': -6.001899437935019,\n  u'NbArticles': 8,\n  u'_id': {u'pays1': u'VC', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.988204355805254,\n  u'NbArticles': 5,\n  u'_id': {u'pays1': u'US', u'pays2': u'OC'}},\n {u'AvgPaysTone': -5.938963854922408,\n  u'NbArticles': 90,\n  u'_id': {u'pays1': u'MZ', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.918701116150387,\n  u'NbArticles': 64,\n  u'_id': {u'pays1': u'GV', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.504032746477928,\n  u'NbArticles': 137,\n  u'_id': {u'pays1': u'SU', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.2032520325203295,\n  u'NbArticles': 7,\n  u'_id': {u'pays1': u'US', u'pays2': u'NR'}},\n {u'AvgPaysTone': -5.164135518592803,\n  u'NbArticles': 663,\n  u'_id': {u'pays1': u'YM', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.135607866661751,\n  u'NbArticles': 14,\n  u'_id': {u'pays1': u'US', u'pays2': u'ER'}},\n {u'AvgPaysTone': -5.131296982635813,\n  u'NbArticles': 36,\n  u'_id': {u'pays1': u'CM', u'pays2': u'US'}},\n {u'AvgPaysTone': -5.021853180411138,\n  u'NbArticles': 657,\n  u'_id': {u'pays1': u'US', u'pays2': u'ES'}}]\n"}]},"apps":[],"jobName":"paragraph_1580046211301_1646131049","id":"20200123-192538_1808910552","dateCreated":"2020-01-26T13:43:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2119"}],"name":"GDELT_Part_3_MongoDB_Queries","id":"2EZ7AYX8Q","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"python:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}