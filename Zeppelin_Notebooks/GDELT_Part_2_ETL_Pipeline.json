{"paragraphs":[{"text":"%md\n## GDELT Data Preprocessing and Analytics with MongoDB and AWS\n\n### Step 2: Insert S3 Data into MongoDB\n\n**Packages**","user":"anonymous","dateUpdated":"2020-01-26T14:08:18+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>GDELT Data Preprocessing and Analytics with MongoDB and AWS</h2>\n<h3>Step 2: Insert S3 Data into MongoDB</h3>\n<p><strong>Packages</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201443_1149508260","id":"20200120-152550_933762085","dateCreated":"2020-01-26T13:43:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:52","dateFinished":"2020-01-26T14:08:21+0000","dateStarted":"2020-01-26T14:08:18+0000"},{"text":"%python\nimport numpy as np\nimport time\nimport timeit\nimport pandas as pd\nimport pymongo as mb\n\nfrom pprint import pprint\nfrom tqdm import tqdm\n\nimport io\nimport boto3","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201448_-1150470707","id":"20200120-212055_1995892076","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:53"},{"text":"%md\n**Data Preprocessing Utilities**","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p><strong>Data Preprocessing Utilities</strong></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201449_-376778614","id":"20200120-212850_2095614315","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:54"},{"text":"%python\ndef get_article_mention_language(translateInfo):\n    \"\"\" For GDELT Mentions\n    \"\"\"\n    if translateInfo=='':\n        language = 'eng'\n    else:\n        language = translateInfo.split(';', 1)[0][-3:]\n    return language\n    \ndef preprocess_gdelt_gkg_tone(x):\n    res = dict()\n    res['tone'] = float(x[0])\n    res['positive_score'] = x[1]\n    res['negative_score'] = x[2]\n    res['polarity'] = x[3]\n    res['activity_reference_density'] = x[4]\n    res['group_reference_density'] = x[5]\n    return res\n\ndef preprocess_gdelt_gkg_location(x):\n    res_list = []\n    # print(x)\n    if len(x) == 0:\n        return []\n        \n    for location in x:\n        if location != '':\n            # print(location)\n            x_split = location.split('#')\n            # print(location, x_split)\n            res = dict()\n            res['type'] = x_split[0]\n            res['full_name'] = x_split[1]\n            res['country_code'] = x_split[2]\n            res['adm1_code'] = x_split[3]\n            res['latitude'] = x_split[4]\n            res['longitude'] = x_split[5]\n            res['featureID'] = x_split[6]\n            res_list.append(res)\n        \n    return res_list\n\ndef preprocess_gdelt_themes(x):\n    res = list(filter(lambda el: el != '', x))\n    return res","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201449_-865849747","id":"20200120-212839_706668011","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:55"},{"text":"%md\n## 1. Setup","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>1. Setup</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201449_-803441938","id":"20200120-153211_394510643","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:56"},{"text":"%md\n### 1.1. Connection: S3 Bucket","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>1.1. Connection: S3 Bucket</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201450_-1893565963","id":"20200120-212159_651688028","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:57"},{"text":"%python\nAWS_ID = \"****************\"\nAWS_KEY = \n\ns3 = boto3.client('s3', aws_access_key_id=AWS_ID,\n                  aws_secret_access_key=AWS_KEY)","user":"anonymous","dateUpdated":"2020-01-26T13:50:57+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201450_-1003726130","id":"20200120-175345_1874277685","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:58"},{"text":"%python\nresponse = s3.list_buckets()\n\n# Output the bucket names\nprint('Existing buckets:')\nfor bucket in response['Buckets']:\n    print bucket['Name']","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Existing buckets:\naws-logs-270494434227-eu-west-3\ngdelt-project-storage-msbd\n"}]},"apps":[],"jobName":"paragraph_1580046201450_-1834443859","id":"20200120-194720_608238798","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:59"},{"text":"%md\n### 1.2. Connection: MongoDB EC2","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>1.2. Connection: MongoDB EC2</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201451_-1001232700","id":"20200120-132822_424542526","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:60"},{"text":"%python\nHOST_SERVER = \"****************\"\nmongo_client = mb.MongoClient(HOST_SERVER)","user":"anonymous","dateUpdated":"2020-01-26T13:51:08+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201451_1025329980","id":"20200120-174706_15928599","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:61"},{"text":"%python\r\nprint(mongo_client.list_database_names())","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[u'MSBD_2019_2020', u'admin', u'config', u'local']\n"}]},"apps":[],"jobName":"paragraph_1580046201451_1269039120","id":"20200120-132900_1279035581","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:62"},{"text":"%md\n### 1.3. Prepare MongoDB Collections","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>1.3. Prepare MongoDB Collections</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201452_-327901644","id":"20200120-212023_35896299","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:63"},{"text":"%python\n# Create MongoDB Database\nmsbd_database = mongo_client['MSBD_2019_2020']\n\n# Create MongoDB Collection in Database (\"SQL Table\")\ngdelt_main_collection = msbd_database['gdelt_main']\ngdelt_gkg_collection = msbd_database['gdelt_gkg']\ngdelt_mentions_collection = msbd_database['gdelt_mentions']","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201452_-1245988771","id":"20200120-134725_1319697499","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:64"},{"text":"%python\nprint(msbd_database.list_collection_names())","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[u'gdelt_main', u'snk']\n"}]},"apps":[],"jobName":"paragraph_1580046201452_-2113981025","id":"20200121-110406_652424341","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:65"},{"text":"%python\n# If in need to reset\ngdelt_main_collection = msbd_database['gdelt_main']\ngdelt_gkg_collection = msbd_database['gdelt_gkg']\ngdelt_mentions_collection = msbd_database['gdelt_mentions']\n\ntry:\n    _ = gdelt_main_collection.drop()\n    print('Collection dropped.')\nexcept:\n    print('Collection already dropped.')\n    \ntry:\n    _ = gdelt_gkg_collection.drop()\n    print('Collection dropped.')\nexcept:\n    print('Collection already dropped.')\n\ntry:\n    _ = gdelt_mentions_collection.drop()\n    print('Collection dropped.')\nexcept:\n    print('Collection already dropped.')\n\ngdelt_main_collection = msbd_database['gdelt_main']\ngdelt_gkg_collection = msbd_database['gdelt_gkg']\ngdelt_mentions_collection = msbd_database['gdelt_mentions']","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Collection dropped.\nCollection dropped.\nCollection dropped.\n"}]},"apps":[],"jobName":"paragraph_1580046201453_816808892","id":"20200121-110447_1317078437","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:66"},{"text":"%md\n## 2. Data Preprocessing and Insertion in MongoDB","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>2. Data Preprocessing and Insertion in MongoDB</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201453_-873663963","id":"20200120-133223_1899961873","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:67"},{"text":"%md\n### 2.1. Get Column Description for GDELT Tables","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>2.1. Get Column Description for GDELT Tables</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201453_-456641311","id":"20200120-210529_1395009253","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:68"},{"text":"%python\nGDELT_EVENTS_INFO = '''https://raw.githubusercontent.com/linwoodc3/gdelt2HeaderRows/master/'''+ \\\n                     '''schema_csvs/GDELT_2.0_Events_Column_Labels_Header_Row_Sep2016.csv'''\nGDELT_MENTIONS_INFO = '''https://raw.githubusercontent.com/linwoodc3/gdelt2HeaderRows/master/'''+ \\\n                       '''schema_csvs/GDELT_2.0_eventMentions_Column_Labels_Header_Row_Sep2016.tsv'''\nGDELT_GKG_INFO = '''https://raw.githubusercontent.com/linwoodc3/gdelt2HeaderRows/master/'''+ \\\n                  '''schema_csvs/GDELT_2.0_gdeltKnowledgeGraph_Column_Labels_Header_Row_Sep2016.tsv'''\n\ngdelt_events_descrip = pd.read_csv(GDELT_EVENTS_INFO, sep=',')\ngdelt_mentions_descrip = pd.read_csv(GDELT_MENTIONS_INFO, sep='\\t')\ngdelt_gkg_descrip = pd.read_csv(GDELT_GKG_INFO, sep='\\t')\n\ngdelt_events_cols = gdelt_events_descrip['tableId'].tolist()\ngdelt_mentions_cols = gdelt_mentions_descrip.iloc[:16,1].tolist()\ngdelt_gkg_cols = gdelt_gkg_descrip['tableId'].tolist()","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201454_-1156280046","id":"20200120-210531_929769383","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:69"},{"text":"%md\n### 2.2. Get List of all available GDELT Files in S3 Bucket","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>2.2. Get List of all available GDELT Files in S3 Bucket</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201454_-220987767","id":"20200120-195543_1786573551","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:70"},{"text":"%python\nBUCKET_NAME = \"****************\"\ns3_resource = boto3.resource('s3')\ngdelt_storage_bucket = s3_resource.Bucket(BUCKET_NAME)","user":"anonymous","dateUpdated":"2020-01-26T13:53:25+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201454_-580913299","id":"20200120-203010_365943829","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:71"},{"text":"%python\r\ngdelt_events_files, gdelt_mentions_files, gdelt_gkg_files = [], [], []\r\nfor temp_gdelt_file in gdelt_storage_bucket.objects.all():\r\n    \r\n    # encode('utf8') required because temp_gdelt_file elements are in unicode\r\n    temp_key_name = temp_gdelt_file.key.encode('utf8')\r\n    \r\n    if 'export' in temp_key_name:\r\n        gdelt_events_files.append(temp_key_name)\r\n            \r\n    elif 'mentions' in temp_key_name:\r\n        gdelt_mentions_files.append(temp_key_name)      \r\n    \r\n    elif 'gkg' in temp_key_name:\r\n        gdelt_gkg_files.append(temp_key_name)","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201455_-1060515524","id":"20200120-133922_802979398","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:72"},{"text":"%python\npprint(gdelt_events_files[:3])\npprint(gdelt_mentions_files[:3])\npprint(gdelt_gkg_files[:3])","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['20181201000000.export.CSV.zip',\n '20181201001500.export.CSV.zip',\n '20181201003000.export.CSV.zip']\n['20181201000000.mentions.CSV.zip',\n '20181201001500.mentions.CSV.zip',\n '20181201003000.mentions.CSV.zip']\n['20181201000000.gkg.csv.zip',\n '20181201001500.gkg.csv.zip',\n '20181201003000.gkg.csv.zip']\n"}]},"apps":[],"jobName":"paragraph_1580046201455_551323386","id":"20200120-204831_1872005861","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:73"},{"text":"%python\nTEMP_FILE_NAME = gdelt_events_files[0]\nobj = s3.get_object(Bucket=BUCKET_NAME, Key=TEMP_FILE_NAME)\ndf = pd.read_csv(io.BytesIO(obj['Body'].read()), compression='zip',\n                 error_bad_lines=True, header=None, index_col=None,\n                 sep='\\t')","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201455_-1071543552","id":"20200120-181937_1146104922","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:74"},{"text":"%python\ndf.columns = gdelt_events_cols\n\ndf.head()","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   GLOBALEVENTID  ...                                          SOURCEURL\n0      806754250  ...  https://bismarcktribune.com/news/national/the-...\n1      806754251  ...  https://bismarcktribune.com/news/national/the-...\n2      806754252  ...  https://www.nbcmiami.com/news/politics/Group-o...\n3      806754253  ...  https://m.lasvegassun.com/news/2018/nov/30/tar...\n4      806754254  ...  https://m.lasvegassun.com/news/2018/nov/30/tar...\n\n[5 rows x 61 columns]\n"}]},"apps":[],"jobName":"paragraph_1580046201455_-1659028627","id":"20200120-205820_2004735804","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:75"},{"text":"%python\ndef s3_to_pandas(bucket_name, file_name, columns):\n    obj = s3.get_object(Bucket=bucket_name, Key=file_name)\n    df = pd.read_csv(io.BytesIO(obj['Body'].read()), compression='zip',\n                     error_bad_lines=True, header=None, index_col=None,\n                     sep='\\t')\n    df.columns = columns\n    return df","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1580046201456_-1694089708","id":"20200120-213850_1995603076","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:76"},{"text":"%md\n### 2.3. Inserting GDELT Events into MongoDB","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>2.3. Inserting GDELT Events into MongoDB</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201456_722897899","id":"20200120-211208_1234840858","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:77"},{"text":"%python\nprint(len(gdelt_mentions_files))\nstart = time.time()\ntime.sleep(3)\nend = time.time()\nprint(end - start)","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"96\n3.00060796738\n"}]},"apps":[],"jobName":"paragraph_1580046201456_1292086482","id":"20200121-111237_797273030","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:78"},{"text":"%python\nstart = time.time()\n\nsuccessful_mongodb_insertions, failed_mongodb_insertions = [], []\n\nfor i, file in enumerate(gdelt_events_files[1:]):\n    \n    if i % 10 == 0:\n        print i\n    \n    try:\n        # Read Pandas DataFrame From S3\n        temp_df = s3_to_pandas(bucket_name=BUCKET_NAME, file_name=file,\n                               columns=gdelt_events_cols)\n        \n        # Preprocess Pandas DataFrame\n        insert_df = temp_df.copy()\n        # insert_df = insert_df.drop\n        insert_df['ActionGeo_CountryCode'] = insert_df['ActionGeo_CountryCode'].fillna('UNK')\n        insert_df = insert_df.fillna('')\n        \n        # Prepare for Insertion into MongoDB\n        insert_df = insert_df.to_dict('records')\n        \n        # Insert into MongoDB\n        _ = gdelt_main_collection.insert_many(insert_df)\n        successful_mongodb_insertions.append(file)\n        \n    except:\n        print 'Failure with file ' + str(i)\n        failed_mongodb_insertions.append(file)\n    \nend = time.time()\nprint(end - start)","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0\n10\n20\n30\n40\n50\n60\n70\n80\n90\n23.9086868763\n"}]},"apps":[],"jobName":"paragraph_1580046201457_999749404","id":"20200120-180954_1670369049","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:79"},{"text":"%python\nprint(gdelt_main_collection.count_documents(filter={}))","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"125079\n"}]},"apps":[],"jobName":"paragraph_1580046201457_695414747","id":"20200121-130813_623958736","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:80"},{"text":"%python\npprint(gdelt_main_collection.find_one(filter={}))","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"{u'ActionGeo_ADM1Code': u'USCT',\n u'ActionGeo_ADM2Code': u'',\n u'ActionGeo_CountryCode': u'US',\n u'ActionGeo_FeatureID': u'209231',\n u'ActionGeo_FullName': u'New Haven, Connecticut, United States',\n u'ActionGeo_Lat': 41.3082,\n u'ActionGeo_Long': -72.9282,\n u'ActionGeo_Type': 3,\n u'Actor1Code': u'',\n u'Actor1CountryCode': u'',\n u'Actor1EthnicCode': u'',\n u'Actor1Geo_ADM1Code': u'',\n u'Actor1Geo_ADM2Code': u'',\n u'Actor1Geo_CountryCode': u'',\n u'Actor1Geo_FeatureID': u'',\n u'Actor1Geo_FullName': u'',\n u'Actor1Geo_Lat': u'',\n u'Actor1Geo_Long': u'',\n u'Actor1Geo_Type': 0,\n u'Actor1KnownGroupCode': u'',\n u'Actor1Name': u'',\n u'Actor1Religion1Code': u'',\n u'Actor1Religion2Code': u'',\n u'Actor1Type1Code': u'',\n u'Actor1Type2Code': u'',\n u'Actor1Type3Code': u'',\n u'Actor2Code': u'GOV',\n u'Actor2CountryCode': u'',\n u'Actor2EthnicCode': u'',\n u'Actor2Geo_ADM1Code': u'USCT',\n u'Actor2Geo_ADM2Code': u'',\n u'Actor2Geo_CountryCode': u'US',\n u'Actor2Geo_FeatureID': u'209231',\n u'Actor2Geo_FullName': u'New Haven, Connecticut, United States',\n u'Actor2Geo_Lat': 41.3082,\n u'Actor2Geo_Long': -72.9282,\n u'Actor2Geo_Type': 3,\n u'Actor2KnownGroupCode': u'',\n u'Actor2Name': u'ADMINISTRATION',\n u'Actor2Religion1Code': u'',\n u'Actor2Religion2Code': u'',\n u'Actor2Type1Code': u'GOV',\n u'Actor2Type2Code': u'',\n u'Actor2Type3Code': u'',\n u'AvgTone': 0.65252854812398,\n u'DATEADDED': 20181201001500L,\n u'EventBaseCode': 190,\n u'EventCode': 190,\n u'EventRootCode': 19,\n u'FractionDate': 2017.9068,\n u'GLOBALEVENTID': 806759323,\n u'GoldsteinScale': -10.0,\n u'IsRootEvent': 0,\n u'MonthYear': 201712,\n u'NumArticles': 1,\n u'NumMentions': 1,\n u'NumSources': 1,\n u'QuadClass': 4,\n u'SOURCEURL': u'https://www.fairfieldcitizenonline.com/local/article/Stamford-CARES-helps-HIV-patient-rebuild-life-13435292.php',\n u'SQLDATE': 20171201,\n u'Year': 2017,\n u'_id': ObjectId('5e299d4ea4ddff4edbc0015c')}\n"}]},"apps":[],"jobName":"paragraph_1580046201457_-1221612263","id":"20200120-175858_1209921885","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:81"},{"text":"%md\n### 2.4. Inserting GDELT GKG into MongoDB","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>2.4. Inserting GDELT GKG into MongoDB</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1580046201458_1148908250","id":"20200120-175818_1955435863","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:82"},{"text":"%python\nstart = time.time()\n\nsuccessful_mongodb_insertions, failed_mongodb_insertions = [], []\n\nsplit_with_semicolon = ['Amounts', 'Counts', 'Locations', 'Organizations',\n                        'Persons', 'Themes']\nsplit_with_comma = ['V2Tone']\ncolumns_to_keep = ['GKGRECORDID', 'DATE', 'SourceCommonName', 'Counts', 'Amounts',\n                   'Locations', 'Organizations', 'Persons', 'Themes', 'V2Tone']\n\nfor i, file in enumerate(gdelt_gkg_files[1:]):\n    \n    if i % 10 == 0:\n        print i\n    \n    try:\n        # Read Pandas DataFrame From S3\n        insert_df = s3_to_pandas(bucket_name=BUCKET_NAME, file_name=file,\n                                 columns=gdelt_gkg_cols)\n    \n        # Preprocess Pandas DataFrame\n        insert_df = insert_df[columns_to_keep].copy()\n        insert_df = insert_df.fillna('')\n        \n        insert_df[split_with_semicolon] = insert_df[split_with_semicolon].applymap(lambda x: x.split(';'))\n        insert_df[split_with_comma] = insert_df[split_with_comma].applymap(lambda x: x.split(','))\n        insert_df['V2Tone'] = insert_df['V2Tone'].apply(lambda x: preprocess_gdelt_gkg_tone(x))\n        insert_df['Locations'] = insert_df['Locations'].apply(lambda x: preprocess_gdelt_gkg_location(x))\n        insert_df['Themes'] = insert_df['Themes'].apply(lambda x: preprocess_gdelt_themes(x))\n        \n        # Prepare for Insertion into MongoDB\n        insert_df = insert_df.to_dict('records')\n        \n        # Insert into MongoDB\n        _ = gdelt_gkg_collection.insert_many(insert_df)\n        successful_mongodb_insertions.append(file)\n    \n    except:\n        print 'Failure with file ' + str(i)\n        failed_mongodb_insertions.append(file)\n    \nend = time.time()\nprint(end - start)","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0\n10\n20\n30\n40\n50\n60\n70\n80\n90\n67.0876371861\n"}]},"apps":[],"jobName":"paragraph_1580046201458_1885193909","id":"20200120-163501_1381883852","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:83"},{"text":"%python\nprint(gdelt_gkg_collection.count_documents(filter={}))","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"154874\n"}]},"apps":[],"jobName":"paragraph_1580046201458_1756135521","id":"20200123-104121_1499003413","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:84"},{"text":"%python\nlen(gdelt_gkg_files)","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"96\n"}]},"apps":[],"jobName":"paragraph_1580046201459_-1708456163","id":"20200123-104437_1766458580","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:85"},{"text":"%python\npprint(gdelt_gkg_collection.find_one(filter={}))","user":"anonymous","dateUpdated":"2020-01-26T13:43:21+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"{u'Amounts': [u''],\n u'Counts': [u''],\n u'DATE': 20181201001500L,\n u'GKGRECORDID': u'20181201001500-0',\n u'Locations': [{u'adm1_code': u'UK',\n                 u'country_code': u'UK',\n                 u'featureID': u'UK',\n                 u'full_name': u'United Kingdom',\n                 u'latitude': u'54',\n                 u'longitude': u'-4',\n                 u'type': u'1'},\n                {u'adm1_code': u'USDC',\n                 u'country_code': u'US',\n                 u'featureID': u'531871',\n                 u'full_name': u'White House, District Of Columbia, United States',\n                 u'latitude': u'38.8951',\n                 u'longitude': u'-77.0364',\n                 u'type': u'3'}],\n u'Organizations': [u'white house', u'cnn'],\n u'Persons': [u'ainsley earhardt',\n              u'donald trump',\n              u'joy behar',\n              u'fox steve doocy',\n              u'ted nugent',\n              u'kid rock',\n              u'sarah palin'],\n u'SourceCommonName': u'wqut.com',\n u'Themes': [u'TAX_WORLDMAMMALS',\n             u'TAX_WORLDMAMMALS_FOX',\n             u'TAX_FNCACT',\n             u'TAX_FNCACT_SINGER',\n             u'USPEC_UNCERTAINTY1',\n             u'SOC_EXPRESSREGRET',\n             u'MEDIA_MSM',\n             u'TAX_FNCACT_CRITIC',\n             u'LEADER',\n             u'TAX_FNCACT_PRESIDENT',\n             u'USPEC_POLITICS_GENERAL1',\n             u'TAX_WORLDLANGUAGES',\n             u'TAX_WORLDLANGUAGES_PALIN',\n             u'EPU_POLICY',\n             u'EPU_POLICY_WHITE_HOUSE'],\n u'V2Tone': {u'activity_reference_density': u'34.9753694581281',\n             u'group_reference_density': u'2.95566502463054',\n             u'negative_score': u'2.95566502463054',\n             u'polarity': u'5.91133004926108',\n             u'positive_score': u'2.95566502463054',\n             u'tone': 0.0},\n u'_id': ObjectId('5e299d85a4ddff4edbc1e9f3')}\n"}]},"apps":[],"jobName":"paragraph_1580046201459_-789087564","id":"20200123-104540_1098746703","dateCreated":"2020-01-26T13:43:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:86"}],"name":"GDELT_Part_2_ETL_Pipeline","id":"2EYENKUP4","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}